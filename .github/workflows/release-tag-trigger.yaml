name: Tag Release Notification

on:
  push:
    tags:
      - 'v*'
      - 'release-*'

jobs:
  notify-website:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger website import
        run: |
          RELEASE_TAG=${GITHUB_REF#refs/tags/}
          echo "New tag created: $RELEASE_TAG"
          
          # Extract version number from tag (e.g., v1.15.0 -> 1.15.0)
          VERSION=$(echo "$RELEASE_TAG" | sed -E 's/^v?([0-9]+\.[0-9]+\.[0-9]+).*/\1/')
        
          # Trigger workflow dispatch in openeverest.github.io
          curl -X POST \
            -H "Authorization: token ${{ secrets.EVEREST_WEBSITE_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/openeverest/openeverest.github.io/actions/workflows/import-docs.yml/dispatches \
            -d "{\"ref\":\"main\",\"inputs\":{\"version\":\"$VERSION\"}}"